 #!/bin/bash

echo "üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram –±–æ—Ç–∞ –¥–ª—è —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è –ê–≤–∏—Ç–æ"
echo "=============================================="

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
if [ -z "$BOT_TOKEN" ]; then
    echo "‚ùå –û–®–ò–ë–ö–ê: BOT_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!"
    echo "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ–≥–æ –≤ GitHub Codespaces Secrets"
    echo "Settings ‚Üí Secrets and variables ‚Üí Codespaces"
    exit 1
fi

if [ -z "$ADMIN_ID" ]; then
    echo "‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: ADMIN_ID –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
    echo "–ë–æ—Ç –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, –Ω–æ –±–µ–∑ –∞–¥–º–∏–Ω-—Ñ—É–Ω–∫—Ü–∏–π"
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
echo "üì¶ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
pip install -r requirements.txt

# –°–æ–∑–¥–∞–µ–º .env —Ñ–∞–π–ª –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
if [ ! -f ".env" ]; then
    echo "üìù –°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞ –∏–∑ —à–∞–±–ª–æ–Ω–∞..."
    if [ -f ".env.example" ]; then
        cp .env.example .env
        echo "‚úÖ .env —Å–æ–∑–¥–∞–Ω. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏!"
    else
        echo "‚ùå .env.example –Ω–µ –Ω–∞–π–¥–µ–Ω!"
    fi
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º Python
echo "üêç –ü—Ä–æ–≤–µ—Ä–∫–∞ Python..."
python --version

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–¥ –±–æ—Ç–∞
echo "ü§ñ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ –±–æ—Ç–∞..."
if [ -f "src/bot.py" ]; then
    echo "‚úÖ src/bot.py –Ω–∞–π–¥–µ–Ω"
else
    echo "‚ùå src/bot.py –Ω–µ –Ω–∞–π–¥–µ–Ω!"
    exit 1
fi

echo ""
echo "‚úÖ –í—Å—ë –≥–æ—Ç–æ–≤–æ –∫ –∑–∞–ø—É—Å–∫—É!"
echo "üì± –ß—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:"
echo "python src/bot.py"
echo ""
echo "üì° –ò–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É 'Run' –≤ Codespaces"
echo ""
echo "üí° –°–æ–≤–µ—Ç—ã:"
echo "1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π"
echo "2. –ù–∞–π–¥–∏—Ç–µ —Å–≤–æ–µ–≥–æ –±–æ—Ç–∞ –≤ Telegram: @avito_ranker_bot"
echo "3. –ù–∞–ø–∏—à–∏—Ç–µ /start –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏"
echo ""
